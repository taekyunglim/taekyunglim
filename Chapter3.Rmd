---
output: word_document
---

# 3. Exploring data

---------------------------------------

**학습목표**
    
* 요약통계량을 사용하여 데이터 탐색
* 시각화를 이용하여 데이터 탐색
* 데이터 탐색하는 동안 문제와 주제 찾기

---------------------------------------

<br>

* 완벽한 데이터는 없다.

* 따라서 대량의 데이터를 가지고 있는 경우 데이터를 살펴보지 않고 바로 모델링 하는 것은 잘못된 결과를 초래할 수 있다.

* 데이터를 탐색하는 방법으로는 요약통계량을 보는방법과 시각화하는 방법이 있다.

<br>

## 3.1 Using summary  statistics to spot problems

<br>

* summary()를 사용함으로서 잠재적인 문제(결측치, 유효하지 않은 값 등) 찾도록 도와준다. 

<br>

#### Listing 3.1 The summary() command
        
```{r}
custdata <- read.csv(file = 'C:\\Users\\Administrator\\Desktop\\Dropbox\\세미나\\custdata.csv', header = T)
summary(custdata)
```

<br>

* is.employed : NA(missing)이 328개 존재한다.

* income : 최소값이 음수로서 유효하지 않은 값이 존재한다.

* health.ins : 보험에 가입한 고객은 84%이다.

* housing.type : NA(missing)이 56개 존재한다.

* age : 그럴듯해 보이지만 최소값과 최대값을 보면 이해할 수 없는 부분이 있다.

* state.of.res : 범주형자료로서 각 지역에 사는 고객의 수를 나타내고 있다.

<br>

### 3.1.1 Typical problems revealed by data summaries
<br>

* missing value : 적절한 조치가 필요한데 결측치가 포함되어 있는 행을 버리거나 0 또는 다른 값으로 대체하는 방법이 있다.

* invalid values and outliers : 유효하지 않은 값을 버릴 것인지 0으로 대체할 것인지 결정해야한다. 이상점은 나이를 알 수 
없거나 대답을 거부한 것일 수 있다. 그리고 고객 중 일부는 특히 수명이 길 수도 있는 것이다.

* 데이터의 범위가 매우 넓은 경우 변환한다(log변환)

* 수입같은 경우는 시급인지 연봉인지 단위확인을 해야한다.

<br>

## 3.2 Spotting problems using graphics and visualization
<br>

* 글 보다는 그림으로 문제를 찾는 것이 더 낫다.

    + 보는 사람 입장에서 글보다는 그림으로 보는 편이 부담이 덜하다.
    + 그림으로 나타내면 명확하다.
    + 시각화는 반복적인 과정이고 데이터에 대한 질문에 답하는 것이 목적이다.
<br>

### 3.2.1 Visually checking distributions for a single variable
<br>

* 시각화를 통해 알 수 있는 것

    + 분포의 최대값은 무엇인가?
    + 최대값은 몇 개 인가?
    + 정규분포형태인가?
    + 데이터는 얼마나 다양하고 일정한 간격인가? 특정범주에 집중되어있는가?

<br>

* figure 3.2 와 같이 density plot이나 histogram은 데이터의 분포를 점검하는데 도움이 된다.

<br>

#### Listing 3.6 Plotting a histogram
        
```{r }
library(ggplot2)
ggplot(custdata) + geom_histogram(aes(x = age), binwidth = 5, fill = 'gray')
```

<br>

* 계급의 구간을 잘 나누어야 한다. 

* 계급의 구간이 너무 넓다면 분포 형태에 대한 정보를 잃는다.

* 계급의 구간이 너무 좁다면 그림을 보기 어렵다.

* 이에 대한 대안은 density plot이다.

<br>

#### Listing 3.7 Producing a density plot
        
```{r }
library(scales)
ggplot(custdata) + geom_density(aes(x = income)) + scale_x_continuous(labels = dollar)
```

<br>

* 위의 그림처럼 한쪽으로 치우친 경우 분포 모양을 자세히 알기 어렵다.

* 따라서 log변환을 통해 자세히 알아보려한다.

<br>

#### Listing 3.8 Creating a log-scaled density plot
        
```{r}
ggplot(custdata) + geom_density(aes(x = income)) +
  scale_x_continuous(breaks = c(100, 1000, 10000, 100000), labels = dollar) + 
  scale_x_log10()
```

<br>

* log변환을 하면 0과 음수들은 무시되므로 그래프를 평가할 때 명심해야한다.

<br>

#### Listing 3.9 Producing a horizontal bar chart
        
```{r }
ggplot(custdata) + geom_bar(aes(x = state.of.res), fill = 'gray') +
  coord_flip() + theme(axis.text.y = element_text(size = rel(0.8)))
```

<br>

* bar chart는 이산형 변수를 위한 histogram이다.

* 위의 그림을 통해 각 지역에 몇명의 고객이 살고 있는지 쉽게 알아볼 수 있다.

<br>

#### Listing 3.10 Producing a bar chart with sorted categories
        
```{r }
statesums <- table(custdata$state.of.res)
statef <- as.data.frame(statesums)
colnames(statef) <- c("state.of.res", "count")
summary(statef)
statef <- transform(statef, state.of.res = reorder(state.of.res, count))
summary(statef)
ggplot(statef) + geom_bar(aes(x = state.of.res, y = count), stat = 'identity', fill = 'gray') +
  coord_flip() + theme(axis.text.y = element_text(size = rel(0.8)))
```

<br>

* 빈도 수가 많은 순으로 데이터를 다시 정리하여 시각화 한것이다.

<br>

* histogram, density plot : 데이터의 범위, 최빈값, 분포, 이상점 등을 점검할 때 사용된다.

* bar chart : 범주형 변수의 값의 빈도수와 상대적인 빈도수를 비교할 때 사용된다.

<br>

### 3.2.2 Visually checking relationships between two variables
<br>

* custdata를 이용하여 두개의 변수 간의 상관관계를 시각화를 통해 알아보려 한다.

    + 나이와 수입간의 상관관계가 존재하나?
    + 어떤 종류의 상관관계이고 얼마나 강한가?
    + input(결혼여부), output(보험가입여부) 상관관계가 존재하나? 얼마나 강한가?

* 이러한 상관관계를 알아보기 위해 line plot과 scatter plot을 이용하려 한다.    

<br>

#### Listing 3.11 Producing a line plot
        
```{r }
x <- runif(100)
y <- x^2 + 0.2*x
ggplot(data.frame(x = x, y = y), aes(x = x, y = y)) + geom_line()
```

<br>

* 위의 그림처럼 데이터가 명백하게 상관관계를 나타내기 힘들 때는 line plot은 유용하지 않다.

* 따라서 이러한 경우에는 scatter plot을 이용한다.

<br>

#### Listing 3.12 Examining the correlation between age and income
        
```{r }
custdata2 <- subset(custdata, (custdata$age > 0 & custdata$age < 100 & custdata$income > 0))
cor(custdata2$age, custdata2$income)
ggplot(custdata2, aes(x = age, y = income)) + geom_point() + ylim(0, 200000)
ggplot(custdata2, aes(x = age, y = income)) + geom_point() + stat_smooth(method = 'lm') + ylim(0, 200000)
ggplot(custdata2, aes(x = age, y = income)) + geom_point() + geom_smooth() + ylim(0, 200000)
```

<br>

* 0~100세, 수입이 0 이상인 고객들만 고려한 데이터를 만들어 상관관계를 본 결과 음의 상관관계를 가지는 것을 알 수 있다.

* 하지만 약한 음의 상관관계를 가지고 있어 한눈에 알아보기 힘들다. 따라서 회귀직선을 그어 약한 음의 상관관계를 알 수 있게 
하였다.

* geom_smooth()를 이용하여 40세까지는 나이가 증가함에 따라 수입도 증가하는 것을 알 수 있고, 55~60세는 수입이 감소하는 경향이 있음을 확인하였다. 

<br>

#### Listing 3.13 Plotting the distribution of health.ins as a function of age
        
```{r }
ggplot(custdata2, aes(x = age, y = as.numeric(health.ins))) +
  geom_point(position = position_jitter(w = 0.05, h = 0.05)) +
  geom_smooth()
```

<br>

* y축은 보험가입여부를 나타내기 위해 0, 1로 변환하였다.

* 나이가 증가함에 따라 보험에 가입한 고객의 수는 증가하고 있음을 확인하였다.

<br>

#### Listing 3.14 Producing a hexbin plot
        
```{r }
library(hexbin)
ggplot(custdata2, aes(x = age, y = income)) + 
  geom_hex(binwidth = c(5, 10000)) +
  geom_smooth(color = 'white', se = F) +
  ylim(0, 200000)
```

<br>

* 데이터가 많을 때에는 점으로 나타내고 알아보기 힘들다.

* 이에 대한 대안으로 데이터를 묶어 색과 명암으로 나타내는 hexbin plot이 있다.

<br>

#### Listing 3.15 Specifying different styles of bar chart
        
```{r }
ggplot(custdata) + geom_bar(aes(x = marital.stat, fill = health.ins))
ggplot(custdata) + geom_bar(aes(x = marital.stat, fill = health.ins), position = 'dodge')
ggplot(custdata) + geom_bar(aes(x = marital.stat, fill = health.ins), position = 'fill')
```

<br>

* 2개의 범주형 변수를 나타내는 가장 간단한 방법은 bar chart이다.

* 

<br>

#### Listing 3.16 Plotting data with a rug
        
```{r }
ggplot(custdata, aes(x = marital.stat)) + 
  geom_bar(aes(fill = health.ins), position = 'fill') +
  geom_point(aes(y = -0.05), size = 0.75, alpha = 0.3, 
             position = position_jitter(h = 0.01))
```

<br>


#### Listing 3.17 Plotting a bar chart with and without facets
        
```{r }
ggplot(custdata2) + 
  geom_bar(aes(x = housing.type, fill = marital.stat), 
           position = 'dodge') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ggplot(custdata2) + 
  geom_bar(aes(x = marital.stat), position = 'dodge', fill = 'darkgray') +
  facet_wrap(~housing.type, scales = 'free_y') +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

<br>


## 3.3 Summary

<br>

* 모델링 하기 전 데이터를 점검해야 나중에 시간을 낭비하지 않게된다.

* summary()를 이용해 데이터에 대한 정보를 알 수 있고 문제점을 찾도록 도와준다.

* 시각화를 통해 데이터의 분포 형태를 알 수 있고 변수들 간의 상관관계를 보여준다.

* 시각화는 반복적인 과정이고 질문에 답할 수 있도록 도와준다.
